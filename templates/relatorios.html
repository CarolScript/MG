<!-- templates/relatorios.html -->
{% extends 'base.html' %}
{% block content %}

<!-- Modal de Notifica√ß√µes -->
<div id="notification-modal" class="modal">
    <div class="modal-background" onclick="document.getElementById('notification-modal').classList.remove('is-active')"></div>
    <div class="modal-content">
        <div class="box">
            <h2 class="title is-4">üì¢ Notifica√ß√µes</h2>
            <ul id="modal-notifications-list" class="notifications-list"></ul>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close" onclick="document.getElementById('notification-modal').classList.remove('is-active')"></button>
</div>

<h1 class="title">Relat√≥rios</h1>

<!-- Sele√ß√£o de Relat√≥rios -->
<div class="tabs is-toggle is-toggle-rounded">
    <ul>
        <li class="is-active" data-tab="vendas"><a>Relat√≥rio de Vendas</a></li>
        <li data-tab="previsao"><a>Previs√£o de Demanda</a></li>
    </ul>
</div>

<!-- Conte√∫do dos Relat√≥rios -->
<div id="conteudoRelatorios">
    <!-- Relat√≥rio de Vendas -->
    <div id="vendas" class="tab-content">
        <div class="box">
            <h2 class="subtitle">Relat√≥rio de Vendas por Per√≠odo</h2>
            <div class="columns is-multiline">
                <div class="column is-12-mobile is-6-tablet">
                    <div class="field">
                        <label class="label">Data In√≠cio</label>
                        <div class="control">
                            <input class="input" type="date" id="data_inicio" max="{{ max_date }}">
                        </div>
                    </div>
                </div>
                <div class="column is-12-mobile is-6-tablet">
                    <div class="field">
                        <label class="label">Data Fim</label>
                        <div class="control">
                            <input class="input" type="date" id="data_fim" max="{{ max_date }}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="field">
                <div class="control">
                    <button class="button is-primary" onclick="fetchRelatorioVendas()">Gerar Relat√≥rio</button>
                </div>
            </div>
            <div id="relatorioVendas"></div>
        </div>
    </div>

    <!-- Bot√µes de Compartilhar e Imprimir -->
    <div class="buttons" style="margin-top: 10px;">
        <button class="button is-info" onclick="compartilharRelatorio()">Compartilhar</button>
        <button class="button is-link" onclick="imprimirRelatorio()">Imprimir</button>
    </div>

    <!-- Previs√£o de Demanda -->
    <div id="previsao" class="tab-content is-hidden">
        <div class="box">
            <h2 class="subtitle">Previs√£o de Demanda</h2>
            <div class="columns is-multiline">
                <div class="column is-12-mobile is-6-tablet">
                    <div class="field">
                        <label class="label">Selecione o Produto</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select id="selectProduto">
                                    <!-- Options ser√£o carregadas via JS -->
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="column is-12-mobile is-6-tablet">
                    <div class="field">
                        <label class="label">Per√≠odo (dias)</label>
                        <div class="control">
                            <input class="input" type="number" id="periodo" value="7" min="1">
                        </div>
                    </div>
                </div>
            </div>
            <div class="field">
                <div class="control">
                    <button class="button is-warning" onclick="fetchPrevisao()">Prever Demanda</button>
                </div>
            </div>
            <div id="relatorioPrevisao"></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        inicializarRelatorios();
        initializeDarkMode(); // Verifica e aplica o modo escuro
        fetchNotificacoes();
    });

    function fetchRelatorioVendas() {
        // Aqui, voc√™ mant√©m o c√≥digo que gera o conte√∫do do relat√≥rio de vendas
        document.getElementById('relatorioVendas').innerHTML = "<p>Conte√∫do do Relat√≥rio de Vendas</p>";

        // Exibe os bot√µes de Compartilhar e Imprimir ap√≥s o relat√≥rio ser gerado
        document.querySelector('.buttons').style.display = "block";
    }

    function compartilharRelatorio() {
        const conteudo = document.getElementById('relatorioVendas').innerText;
        if (navigator.share) {
            navigator.share({
                title: 'Relat√≥rio de Vendas',
                text: conteudo
            }).then(() => {
                console.log('Compartilhamento bem-sucedido!');
            }).catch(error => {
                console.error('Erro ao compartilhar:', error);
            });
        } else {
            alert('Fun√ß√£o de compartilhamento n√£o suportada neste dispositivo.');
        }
    }

    function imprimirRelatorio() {
        const conteudo = document.getElementById('relatorioVendas').innerHTML;
        const janelaImpressao = window.open('', '', 'height=600,width=800');
        janelaImpressao.document.write('<html><head><title>Imprimir Relat√≥rio de Vendas</title></head><body>');
        janelaImpressao.document.write(conteudo);
        janelaImpressao.document.write('</body></html>');
        janelaImpressao.document.close();
        janelaImpressao.print();
    }
</script>
{% endblock %}
